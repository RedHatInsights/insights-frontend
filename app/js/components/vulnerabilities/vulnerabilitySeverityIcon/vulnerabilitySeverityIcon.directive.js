/*global require*/
'use strict';

const componentsModule = require('../../');

// https://github.com/RedHatInsights/vmaas/issues/206
function emptyValueCheck (value) {
    return (value === '') ? 'Unknown' : value;
}

/**
 * @ngInject
 */
function vulnerabilitySeverityIconCtrl ($scope, gettextCatalog) {
    if ($scope.showLabel === undefined) {
        $scope.showLabel = true;
    }

    $scope.$watchGroup(['severity', 'impact'], function ([severity, impact]) {
        if (severity !== undefined) {
            $scope.value = emptyValueCheck(severity);
            $scope.tooltip = gettextCatalog.getString('RHSA Severity: {{severity}}', {
                severity
            });
        } else if (impact !== undefined) {
            $scope.value = emptyValueCheck(impact);
            $scope.tooltip = gettextCatalog.getString('CVE Impact: {{impact}}', {impact});
        }
    });
}

function vulnerabilitySeverityIcon() {
    return {
        scope: {
            severity: '<?',
            impact: '<?',
            showLabel: '<'
        },
        templateUrl: 'js/components/vulnerabilities/vulnerabilitySeverityIcon/' +
            'vulnerabilitySeverityIcon.html',
        restrict: 'E',
        replace: true,
        controller: vulnerabilitySeverityIconCtrl
    };
}

componentsModule.directive('vulnerabilitySeverityIcon', vulnerabilitySeverityIcon);
