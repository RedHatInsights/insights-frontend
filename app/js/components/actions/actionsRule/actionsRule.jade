//platform-filter
actions-breadcrumbs.actions-breadcrumbs.push-top-narrow(ng-hide='loading')
section.gray(ng-hide='loading')
  h2
    .severity-icon.fa-small(ng-if='ruleDetails.severity', severity='ruleDetails.severity')
    | &nbsp;{{ruleDetails.description}}
    .pull-right
      ansible-icon(value='ruleDetails.ansible')
  p(ng-bind-html='ruleDetails.generic_html | trust_html')
section
  h1.page-title(translate, ng-if='ruleDetails.type !== "osp"') Impacted Systems ({{allSystems.length}})
  h1.page-title(translate, ng-if='ruleDetails.type === "osp"') Impacted Deployments
  .row
    .col-sm-12
      actions-rule-filters

  div(infinite-scroll='doScroll()', infinite-scroll-disabled='disableScroll()', infinite-scroll-immediate-check='false')

    .card-table-header(ng-show='getListType() === listTypes.card')
      .row
        .col-sm-4
          input.action-checkbox(
            tooltip='Select All',
            type='checkbox',
            ng-indeterminate='checkboxes.indeterminate',
            ng-model='checkboxes.checked',
            ng-change='checkboxes.checkboxChecked(checkboxes.checked, ruleSystems)')
          label(translate) &nbsp; Name
        .col-sm-4
          strong(translate) Host &nbsp;
          span(ng-if='checkboxes.totalChecked') &nbsp;({{checkboxes.totalChecked}} Selected)
        .col-sm-4.text-right
          strong(translate) Action Count

    // Show Create Playbook, Add to Plan if at least one system has been selected
    .row.row-short
      .col-sm-6
        .btn-group.insights-dropdown
          a.btn.btn-outline.btn-xs.dropdown-toggle(
            data-toggle='dropdown',
            aria-haspopup='true',
            aria-expanded='false',
            translate,
            ng-disabled='!checkboxes.totalChecked || !config.isPlannerEnabled') Actions
            i.caret.dropdown-caret
          ul.dropdown-menu
            li(ng-if='config.isPlannerEnabled',)
              a(ng-click='addToPlan()', translate) Add to plan

      .col-sm-6
        list-type.text-right-sm

    .row.row-short
      .col-sm-12
        system-card(ng-repeat='system in ruleSystems | orderBy:predicate:reverse',
          system='system',
          rule='ruleDetails',
          checkboxes='checkboxes',
          ng-show='getListType() === listTypes.card')

    .row.row-short(ng-show='getListType() === listTypes.table')
        .col-sm-12
          table.table.nomar.ng-table.table-fixed
            thead
              tr
                th(style='width: 30px')
                  input.action-checkbox(
                    tooltip='Select All',
                    type="checkbox",
                    ng-indeterminate="checkboxes.indeterminate",
                    ng-model='checkboxes.checked',
                    ng-change='checkboxes.checkboxChecked(checkboxes.checked, ruleSystems)')
                th.sortable(style='width: 27%;', ng-class="predicate | sortClass:'system_type_id':reverse", ng-click="predicate = 'system_type_id'; reverse=!reverse")
                  .sort-indicator(translate) Type
                th.sortable(ng-class="predicate | sortClass:'toString':reverse", ng-click="predicate = 'toString'; reverse=!reverse")
                  .sort-indicator(translate) Name
                th.sortable(style="width: 27%;", ng-class="predicate | sortClass:'last_check_in':reverse", ng-click="predicate = 'last_check_in'; reverse=!reverse")
                  .sort-indicator(translate) Reported 
            tbody
              tr(ng-click='checkboxes.rowClick($event, system.system_id)',
                 ng-mousedown='checkboxes.rowClick($event, system.system_id)',
                 ng-repeat='system in ruleSystems | orderBy:predicate:reverse',
                 data-id="{{system.system_id}}")
                td(style='width: 30px')
                  input.selectme(
                    type='checkbox',
                    ng-model='checkboxes.items[system.system_id]',
                    ng-click='checkboxes.rowClick($event, system.system_id); $event.stopPropagation();',
                  )
                td(style='width: 27%;')
                  type-icon(type-id='system.system_type_id', include-text='true')
                td.break
                  a(ng-click='showSystem(system)') {{ system.toString }}
                td(style='width: 27%;') {{ ::system.last_check_in | timeAgo}}

  .row.row-short(ng-hide='loading')
    .col-xs-12
      .actions-back
.margin-top(ng-show='loading')
  .text-center
    .spinner.spinner-lg
